<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* 背景設定 */
        body {
            margin: 0;
            overflow: hidden;
        }

        #main {
            width: 100vw;
            height: 100vh;
            margin: auto;
            position: relative;
            overflow: hidden;
        }

        #info {
            position: absolute;
        }

        #round {
            height: 60px;
            font-size: 35px;
            line-height: 60px;
            background: #8c8;
            border: 3px solid rgb(55, 49, 130);
            font-weight: bold;
        }

        table {
            font-size: 30px;
            line-height: 40px;
            width: 100%;
            border-collapse: collapse
        }

        table td {
            font-weight: bold;
            padding: 3px;
            border: 1px solid black;
            background: #fcc;
        }

        table tr:nth-child(even) td {
            text-align: right;
            font-weight: normal;
            background: #FFF;
        }

        /* 按鈕設定 */
        #start {
            width: 10vw;
            height: 5vh;
            background-color: #8c8;
            font-size: 4vh;
            line-height: 5vh;
            text-align: center;
            position: absolute;
            z-index: 1;
            top: calc(50% - 2.5vh);
            left: calc(50% - 5vw);
            border: #000 1px solid;
            box-shadow: 0 0 5px black;
        }

        #start:hover {
            transition: 0.3s;
            box-shadow: 0 0 15px rgb(25, 183, 226);
            background-color: rgb(140, 144, 255);
        }


        #timer {
            width: 20vw;
            height: 15vh;
            font-size: 10vh;
            line-height: 15vh;
            text-align: center;
            position: absolute;
            top: calc(50% - 7.5vh);
            left: calc(50% - 10vw);
            border: rgb(111, 107, 107) 1px solid;
            color: rgb(204, 204, 204);
            display: none;
            transition: 3s;
        }

        /* 點擊箱設定 */
        :root {
            --size: 60px;
        }

        #box {
            width: 30%;
            height: 20%;
            border: 1px black solid;
            position: absolute;
            left: 40%;
            top: 10%;
            overflow: hidden;
        }

        .b {
            width: var(--size);
            height: var(--size);
            background: #000;
            position: absolute;
        }

        .b1 {
            left: 1px;
            top: 1px;
        }

        .b2 {
            left: calc(100% - var(--size));
            top: 0;
        }

        .b3 {
            left: 0;
            top: calc(100% - var(--size));
        }

        .b4 {
            left: calc(100% - var(--size));
            top: calc(100% - var(--size));
        }

        .b5 {
            left: calc(50% - var(--size)/2);
            top: calc(50% - var(--size)/2);
        }

        .ok {
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            -webkit-user-drag: none;
        }
    </style>
</head>

<body>
    <div id="info">
        <div id="round"></div>
        <table id="highest">
            <tr>
                <td>Highest:</td>
            </tr>
            <tr>
                <td>anan</td>
            </tr>
            <tr>
                <td> Round:</td>
            </tr>
            <tr>
                <td>53</td>
            </tr>
        </table>
    </div>
    <div id="timer">999.15秒</div>
    <div id="start">START</div>
    <div id="main">
        <div id="box">
            <div class="b b1"></div>
            <div class="b b2"></div>
            <div class="b b3"></div>
            <div class="b b4"></div>
            <div class="b b5"></div>
        </div>

        <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'
            integrity='sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=='
            crossorigin='anonymous'></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            // -------------------------------------------------------基本局數設定
            let round = 1
            const update = function () {
                $('#round').text(`Round ${round}`)
            }
            update()
            let rest = 5
            // 檢查是否下一關(點擊到方塊後執行)
            const check = () => {
                rest <= 0 ? rest = 5 : round++
                round >= 10 ? end() : true
            }
            // 結束後動作
            const end = (s) => {
                Swal.fire(`你的紀錄是${s}秒`)
                $('#start').css({ display: 'block' })
                $('#timer').css({ display: 'none' })

            }
            // 開始後動作

            $('#start').click(function () {
                $('#start').css({ display: 'none' })
                $('#timer').css({ display: 'block' })
                round1()
            })
            // ---------------------------------------------------------------遊戲設定
            // 亂數生成器
            const ran = function (i) {
                return Math.ceil(Math.random() * (i + 1))
            }
            //宣告又不立刻執行+帶入變數
            let playing = 0
            // 按壓後開始
            $('.b').click(function (e) {
                // $(this).fadeTo(500,0)
                $(this).addClass('ok')
                // 如果都壓完，隔一秒後下一關
                if ($('.ok').length == 5) {
                    clearInterval(playing)
                    setTimeout(() => {
                        $('.ok').removeClass('ok')
                        round++
                        update()
                        switch (round) {
                            case 2:
                                round2()
                                break;
                            case 3:
                                round3()
                                break;
                            case 4:
                                round4()
                                break;
                            case 5:
                                round5()
                                break;
                            case 6:
                                round6()
                                break;
                            case 7:
                                round7()
                                break;

                        }
                    }, 1000)
                }
            })
            // -------第一關箱子移動
            // 初始動畫
            let setTransition = function () {
                $('#box').css({ transition: `${speed / 1000}s` })
            }
            // 初始速度
            let speed = 1500
            //  -----箱子移動
            // 建立一個object去取function(因為不能改function)
            let css = {
                action:
                    function () {
                        return { left: `calc(${ran(100)}% - 15%)`, top: `calc(${ran(100)}% - 10%)` }
                    }
            }
            class actionC{
// ***************************************************
// 為了可共用move() 
// 1.把Css { left: `calc(${ran(100)}% - 15%)`, top: `calc(${ran(100)}% - 10%)` } 用變數拆出來誕生上方的 css
// 2.要變換move() 裡面的function ，只想到用物件來變換(因為let 不能改) 誕生css.action()
// 3.發現 move()用變數宣告 會無法改值，所以改用object 來重新宣告重讀css.action()
// 4.但目前playing 似乎就無法被clearInterval...
// ***************************************************
                move(){
                    $('#box').css(css.action())
                    playing = setInterval(function () {
                        setTransition()
                        $('#box').css(css.action())
                    }, speed)
                }
            }

            let boxMove = function () {
                $('#box').css(css.action())
                playing = setInterval(function () {
                    setTransition()
                    $('#box').css(css.action())
                }, speed)
            }

            // -------第1關箱子移動
            const round1 = function () {
                var d = new actionC();
                d.move()
            }
            // -------第2關箱子高速移動
            const round2 = function () {
                speed = 1000
                var d = new actionC();
                d.move()
            }

            // -------第3關箱子旋轉+移動
            let degree = 0
            const round3 = function () {
                css = {
                    action:
                        function () {
                            return { left: `calc(${ran(100)}% - 15%)`, top: `calc(${ran(100)}% - 10%)`, transform: `rotate(${degree += 90}deg)` }
                        }
                }
                speed = 1500
                var d = new actionC();
                d.move()
            }
            // -------第4關箱子翻轉+移動
            
        </script>
</body>

</html>